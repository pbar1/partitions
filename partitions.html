<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Young Diagrams</title>
    <style>
      body {
        font-family: sans-serif;
        margin: 20px;
        background-color: white;
        color: black;
      }
      #controls {
        margin-bottom: 20px;
      }
      canvas {
        margin: 10px;
        border: 1px solid #ccc;
      }
      .diagram {
        display: inline-block;
        margin: 10px;
        vertical-align: top;
      }
      .number-section {
        margin: 20px 0;
      }
      .number-title {
        font-size: 18px;
        font-weight: bold;
        margin: 10px 0;
      }
      .separator {
        border: none;
        border-top: 2px solid #ccc;
        margin: 15px 0;
      }

      @media (prefers-color-scheme: dark) {
        body {
          background-color: #1a1a1a;
          color: white;
        }
        canvas {
          border: 1px solid #666;
        }
        .separator {
          border-top-color: #666;
        }
      }
    </style>
  </head>
  <body>
    <div id="controls">
      <label for="number">Enter N: </label>
      <input type="number" id="number" value="5" min="1" />
      <label for="modulus">Mod (optional): </label>
      <input type="number" id="modulus" min="2" placeholder="leave empty for no mod" />
      <label>
        <input type="checkbox" id="showConjugates" />
        Show conjugate partitions
      </label>
      <label>
        <input type="checkbox" id="onlyShowN" />
        Only show N
      </label>
      <label>
        <input type="checkbox" id="reverseOrder" />
        Show ascending order
      </label>
      <button onclick="drawDiagrams()">Go</button>
    </div>
    <div id="output"></div>

    <script>
      // Generate all partitions of n
      function partitions(n, max = n) {
        if (n === 0) return [[]];
        let result = [];
        for (let i = Math.min(max, n); i >= 1; i--) {
          for (let rest of partitions(n - i, i)) {
            result.push([i, ...rest]);
          }
        }
        return result;
      }

      // Compute the conjugate (transpose) of a partition
      function conjugate(partition) {
        if (partition.length === 0) return [];
        const maxPart = partition[0];
        const result = [];
        for (let i = 1; i <= maxPart; i++) {
          result.push(partition.filter(part => part >= i).length);
        }
        return result;
      }

      // Check if partition is "wide" (first part >= number of parts)
      function isCanonical(partition) {
        if (partition.length === 0) return true;
        return partition[0] >= partition.length;
      }

      const colors = [
        "#FF595E",
        "#FFCA3A",
        "#8AC926",
        "#1982C4",
        "#6A4C93",
        "#FF924C",
        "#FF4D6D",
        "#4CAF50",
      ];

      function drawDiagram(ctx, partition, cellSize = 20) {
        ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
        for (let row = 0; row < partition.length; row++) {
          ctx.fillStyle = colors[row % colors.length];
          for (let col = 0; col < partition[row]; col++) {
            ctx.fillRect(col * cellSize, row * cellSize, cellSize, cellSize);
            ctx.strokeRect(col * cellSize, row * cellSize, cellSize, cellSize);
          }
        }
      }

      function drawDiagrams() {
        const N = parseInt(document.getElementById("number").value);
        const modulusInput = document.getElementById("modulus").value;
        const modulus = modulusInput ? parseInt(modulusInput) : null;
        const showConjugates = document.getElementById("showConjugates").checked;
        const onlyShowN = document.getElementById("onlyShowN").checked;
        const reverseOrder = document.getElementById("reverseOrder").checked;
        const output = document.getElementById("output");
        output.innerHTML = ""; // clear old

        // Apply modulus to the base number and all numbers in range
        let effectiveN = modulus ? N % modulus : N;
        let numbersToShow = onlyShowN ? [effectiveN] : Array.from({length: effectiveN}, (_, i) => i + 1);
        
        // If modulus is applied and we're showing all numbers, also apply modulus to each
        if (modulus && !onlyShowN) {
          const originalNumbers = Array.from({length: N}, (_, i) => i + 1);
          numbersToShow = [...new Set(originalNumbers.map(n => n % modulus))].filter(n => n > 0).sort((a, b) => a - b);
        }
        
        // Default is descending (highest first), reverse if checkbox is checked
        if (!reverseOrder) {
          numbersToShow = numbersToShow.reverse();
        }

        for (let i = 0; i < numbersToShow.length; i++) {
          const currentN = numbersToShow[i];
          let parts = partitions(currentN);
          
          if (!showConjugates) {
            parts = parts.filter(isCanonical);
          }

          // Add section for this number
          const section = document.createElement("div");
          section.className = "number-section";

          const title = document.createElement("div");
          title.className = "number-title";
          if (modulus && !onlyShowN) {
            // Show which original numbers map to this modulus result
            const originalNumbers = Array.from({length: N}, (_, i) => i + 1).filter(n => n % modulus === currentN);
            title.textContent = `Partitions of ${currentN} (from ${originalNumbers.join(', ')} mod ${modulus})`;
          } else if (modulus) {
            title.textContent = `Partitions of ${currentN} (${N} mod ${modulus})`;
          } else {
            title.textContent = `Partitions of ${currentN}`;
          }
          section.appendChild(title);

          for (let part of parts) {
            const maxCols = Math.max(...part);
            const canvas = document.createElement("canvas");
            canvas.width = maxCols * 22;
            canvas.height = part.length * 22;
            const ctx = canvas.getContext("2d");
            drawDiagram(ctx, part);
            const div = document.createElement("div");
            div.className = "diagram";
            div.appendChild(canvas);
            div.appendChild(document.createElement("br"));
            div.appendChild(document.createTextNode(JSON.stringify(part)));
            section.appendChild(div);
          }

          output.appendChild(section);

          // Add separator except after the last section
          if (i < numbersToShow.length - 1) {
            const separator = document.createElement("hr");
            separator.className = "separator";
            output.appendChild(separator);
          }
        }
      }

      // Add enter key listener to the number and modulus inputs
      document.getElementById("number").addEventListener("keypress", function(event) {
        if (event.key === "Enter") {
          drawDiagrams();
        }
      });
      
      document.getElementById("modulus").addEventListener("keypress", function(event) {
        if (event.key === "Enter") {
          drawDiagrams();
        }
      });
    </script>
  </body>
</html>
